<div class="gauss-jordan-container" *ngIf="matrixData">
  <h3>{{ title }}</h3>

  <!-- Matriz Aumentada -->
  <div class="augmented-matrix">
    <div class="matrix-section">
      <h4>Matriz Aumentada [A | I]:</h4>
      <div class="matrix">
        <div class="matrix-bracket left">[</div>

        <div class="matrix-content">
          <div class="matrix-row" *ngFor="let row of augmentedMatrix">
            <div class="matrix-cell" *ngFor="let cell of row; let i = index" [class.identity]="i >= 3">
              {{ formatNumber(cell) }}
            </div>
          </div>
        </div>

        <div class="matrix-bracket right">]</div>
      </div>
    </div>

    <!-- Separador -->
    <div class="separator">‚Üí</div>

    <!-- Matriz Identidad Resultante -->
    <div class="matrix-section">
      <h4>Matriz Inversa A‚Åª¬π:</h4>
      <div class="matrix" *ngIf="inverseMatrix; else noInverse">
        <div class="matrix-bracket left">[</div>

        <div class="matrix-content">
          <div class="matrix-row" *ngFor="let row of inverseMatrix.matrix">
            <div class="matrix-cell inverse-cell" *ngFor="let cell of row">
              {{ formatNumberInverseMatrix(cell) }}
            </div>
          </div>
        </div>

        <div class="matrix-bracket right">]</div>
      </div>

      <ng-template #noInverse>
        <div class="no-data">
          {{ isLoading ? 'Calculando...' : 'Calcular matriz inversa' }}
        </div>
      </ng-template>
    </div>

    <!-- Matriz de Multiplicaci√≥n A‚Åª¬π √ó B -->
    <div class="matrix-section" *ngIf="multiplicationMatrix">
      <h4>Matriz A‚Åª¬π √ó Vector B:</h4>
      <div class="matrix">
        <div class="matrix-bracket left">[</div>

        <div class="matrix-content">
          <div class="matrix-row" *ngFor="let row of multiplicationMatrix">
            <div class="matrix-cell multiplication-cell" *ngFor="let cell of row">
              {{ formatMultiplicationNumber(cell) }}
            </div>
          </div>
        </div>

        <div class="matrix-bracket right">]</div>
      </div>
    </div>
  </div>

  <!-- Bot√≥n de c√°lculo -->
  <div class="controls">
    <button class="calculate-btn" (click)="calculateInverse()" [disabled]="isLoading">
      {{ isLoading ? 'Calculando...' : 'üî¢ Calcular Matriz Inversa' }}
    </button>
  </div>


  <div class="explanation" *ngIf="multiplicationMatrix">
    <p><strong>Donde Vector B = [Œ£Y, Œ£X‚ÇÅY, Œ£X‚ÇÇY] =
        [{{ formatNumber(matrixData.sumY) }},
        {{ formatNumber(matrixData.sumX1y) }},
        {{ formatNumber(matrixData.sumX2y) }}]</strong></p>
    <p>Los coeficientes finales son la suma de cada fila:</p>
    <ul>
      <li>a = {{ formatMultiplicationNumber(multiplicationMatrix[0][0]) }} +
        {{ formatMultiplicationNumber(multiplicationMatrix[0][1]) }} +
        {{ formatMultiplicationNumber(multiplicationMatrix[0][2]) }} =
        {{ formatNumberInverseMatrix(calculatedCoefficients[0]) }}</li>
      <li>b‚ÇÅ = {{ formatMultiplicationNumber(multiplicationMatrix[1][0]) }} +
        {{ formatMultiplicationNumber(multiplicationMatrix[1][1]) }} +
        {{ formatMultiplicationNumber(multiplicationMatrix[1][2]) }} =
        {{ formatNumberInverseMatrix(calculatedCoefficients[1]) }}</li>
      <li>b‚ÇÇ = {{ formatMultiplicationNumber(multiplicationMatrix[2][0]) }} +
        {{ formatMultiplicationNumber(multiplicationMatrix[2][1]) }} +
        {{ formatMultiplicationNumber(multiplicationMatrix[2][2]) }} =
        {{ formatNumberInverseMatrix(calculatedCoefficients[2]) }}</li>
    </ul>
  </div>


  <!-- Resultados con coeficientes calculados por suma de filas -->
  <div class="results" *ngIf="calculatedCoefficients.length === 3">
    <h4>Coeficientes de Regresi√≥n (Suma de Filas):</h4>
    <div class="coefficients">
      <div class="coefficient">
        <span>a (Intercepto) = {{ formatNumberInverseMatrix(calculatedCoefficients[0]) }}</span>
        <span>b‚ÇÅ (X‚ÇÅ) = {{ formatNumberInverseMatrix(calculatedCoefficients[1]) }}</span>
        <span>b‚ÇÇ (X‚ÇÇ) = {{ formatNumberInverseMatrix(calculatedCoefficients[2]) }}</span>
      </div>
    </div>

    <div class="equation" *ngIf="inverseMatrix?.equation">
      <strong>Ecuaci√≥n:</strong> {{ inverseMatrix?.equation }}
    </div>
  </div>

  <!-- Formulario de Estimaci√≥n -->
<div class="estimation-section" *ngIf="calculatedCoefficients.length === 3">
  <button class="toggle-estimation-btn" (click)="toggleEstimationForm()">
    {{ showEstimationForm ? '‚ùå Ocultar' : 'üîÆ Mostrar' }} Calculadora de Estimaciones
  </button>

  <div class="estimation-form" *ngIf="showEstimationForm">
    <h4>Calculadora de Estimaciones</h4>
    
    <div class="estimation-equation">
      <strong>Ecuaci√≥n: </strong>
      ≈∑ = {{ formatNumberInverseMatrix(calculatedCoefficients[0]) }} + 
          {{ formatNumberInverseMatrix(calculatedCoefficients[1]) }}*X‚ÇÅ + 
          {{ formatNumberInverseMatrix(calculatedCoefficients[2]) }}*X‚ÇÇ
    </div>

    <div class="input-group">
      <label for="estimationX1">Valor de X‚ÇÅ:</label>
      <input type="number" id="estimationX1" [(ngModel)]="estimationX1" 
             (input)="calculateEstimation()" step="0.01" placeholder="Ingrese X‚ÇÅ">
    </div>

    <div class="input-group">
      <label for="estimationX2">Valor de X‚ÇÇ:</label>
      <input type="number" id="estimationX2" [(ngModel)]="estimationX2" 
             (input)="calculateEstimation()" step="0.01" placeholder="Ingrese X‚ÇÇ">
    </div>

    <div class="estimation-result" *ngIf="estimationResult !== null">
      <h5>Resultado de la Estimaci√≥n:</h5>
      <div class="result-calculation">
        ≈∑ = {{ formatNumberInverseMatrix(calculatedCoefficients[0]) }} + 
            {{ formatNumberInverseMatrix(calculatedCoefficients[1]) }}*{{ estimationX1 }} + 
            {{ formatNumberInverseMatrix(calculatedCoefficients[2]) }}*{{ estimationX2 }}<br>
        ≈∑ = {{ formatNumberInverseMatrix(calculatedCoefficients[0]) }} + 
            {{ formatNumberInverseMatrix(calculatedCoefficients[1] * (estimationX1 || 0)) }} + 
            {{ formatNumberInverseMatrix(calculatedCoefficients[2] * (estimationX2 || 0)) }}<br>
        ≈∑ = <strong>{{ formatEstimationResult(estimationResult) }}</strong>
      </div>
    </div>

    <div class="no-estimation" *ngIf="estimationResult === null && (estimationX1 !== null || estimationX2 !== null)">
      <p>‚ö†Ô∏è Ingrese ambos valores (X‚ÇÅ y X‚ÇÇ) para calcular la estimaci√≥n</p>
    </div>
  </div>
</div>

  <!-- Error -->
  <div class="error" *ngIf="error">
    <div class="error-message">
      ‚ö†Ô∏è {{ error }}
    </div>
  </div>

  <!-- Explicaci√≥n -->
  <div class="explanation">
    <h4>Proceso de Gauss-Jordan:</h4>
    <p>La matriz aumentada [A | I] se transforma mediante operaciones elementales de fila hasta obtener [I | A‚Åª¬π]</p>
  </div>
</div>